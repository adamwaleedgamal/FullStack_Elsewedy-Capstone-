import{r as b,u as F,j as s,a as p,S as c,b as A,p as L,T as y,C as O,X as K,U as T,c as C,f as G}from"./index-DX85qj1P.js";const Z=({setCurrentPage:P,setSelectedPhase:M,currentStudentId:l})=>{const[v,w]=b.useState([]),[E,S]=b.useState(!0),{showError:R}=F(),k=e=>{if(!e)return"No deadline";try{const t=L(e),n=new Date(t.toLocaleString("en-US",{timeZone:"Africa/Cairo"}));return G(n,"MMM dd, yyyy, hh:mm a")}catch(t){return console.error("Error formatting date:",t),"Invalid date"}},x=e=>{if(!e)return null;try{const t=L(e),i=new Date(t.toLocaleString("en-US",{timeZone:"Africa/Cairo"}))-new Date;if(i<=0)return null;const r=Math.floor(i/(1e3*60*60*24)),u=Math.floor(i%(1e3*60*60*24)/(1e3*60*60)),o=Math.floor(i%(1e3*60*60)/(1e3*60));return r>0?`${r} day${r>1?"s":""} remaining`:u>0?`${u} hour${u>1?"s":""} remaining`:o>0?`${o} minute${o>1?"s":""} remaining`:"Less than 1 minute remaining"}catch(t){return console.error("Error calculating time remaining:",t),null}};b.useEffect(()=>{(async()=>{try{console.log(`Fetching tasks for student ${l}...`);const t=await p.get(`http://localhost:5048/api/AccountTask/StudentTasks/${l}`);console.log("Tasks response:",t.data);const n=t.data.$values||t.data||[];console.log("PhasesSection - Raw tasks array:",n);const d=await p.get("http://localhost:5048/api/TaskSubmissions"),i=d.data.$values||d.data||[];console.log("Task submissions:",i);const r=await p.get("http://localhost:5048/api/TeamMembers"),o=(r.data.$values||r.data||[]).find(a=>a.teamMemberAccountId===l);let g=null;o&&(g=o.teamId);const j=n.map(a=>{const m=g?i.find(h=>h.taskId===a.id&&h.teamId===g):null;let f="Pending",N=c.TASK_PENDING,D=!1;if(m)N=m.statusId,f=A.getStatusText(m.statusId,a.taskDeadline,!1,a.isLate);else{D=!0;const h=x(a.taskDeadline)===null,U=a.isLate||h;f=A.getStatusText(c.TASK_PENDING,a.taskDeadline,!0,U)}return{id:a.id,title:a.taskName||"Untitled Task",description:a.taskDescription||"No description available",status:f,statusId:N,isPendingTask:D,isLate:a.isLate||!1,deadline:a.taskDeadline,deadlineFormatted:a.taskDeadline?k(a.taskDeadline):"No deadline",gradeId:a.gradeId,adminAccountId:a.adminAccountId,submission:m}});console.log("PhasesSection - Formatted tasks:",j),w(j),S(!1)}catch(t){console.error("Error fetching tasks:",t),R("Failed to load tasks"),S(!1)}})()},[l]);const I=e=>{switch(e){case"Completed":return"#38a169";case"Completed Late":return"#d69e2e";case"Submitted":return"#3182ce";case"Submitted On Time":return"#3182ce";case"Submitted Late":return"#e53e3e";case"Rejected":return"#e53e3e";case"Pending":return"#d69e2e";case"Late":return"#e53e3e";case"Deadline Passed":return"#e53e3e";default:return"#718096"}},$=e=>{switch(e){case"Completed":return s.jsx(C,{size:16});case"Completed Late":return s.jsx(C,{size:16});case"Submitted":return s.jsx(T,{size:16});case"Submitted On Time":return s.jsx(T,{size:16});case"Submitted Late":return s.jsx(T,{size:16});case"Rejected":return s.jsx(K,{size:16});case"Pending":return s.jsx(O,{size:16});case"Late":return s.jsx(y,{size:16});case"Deadline Passed":return s.jsx(y,{size:16});default:return s.jsx(AlertCircle,{size:16})}},z=(e,t=80)=>e?e.length<=t?e:e.substring(0,t)+"...":"",_=e=>{console.log("Task clicked:",e);const t={id:e.id,title:e.title,description:e.description,status:e.status,deadline:e.deadline,gradeId:e.gradeId,adminAccountId:e.adminAccountId,taskName:e.title,taskDescription:e.description,statusId:e.status==="Pending"?c.TASK_PENDING:e.status==="Submitted"?c.TASK_IN_PROGRESS:c.TASK_SUBMITTED_ON_TIME,taskDeadline:e.deadline,submission:e.submission?{id:e.submission.id,taskId:e.submission.taskId,teamId:e.submission.teamId,teamLeaderId:e.submission.teamLeaderId,glink:e.submission.glink,note:e.submission.note,feedback:e.submission.feedback,statusId:e.submission.statusId,submittedDate:e.submission.submittedDate,createdAt:e.submission.createdAt,updatedAt:e.submission.updatedAt}:null};console.log("Formatted task data:",t),M(t),P("task-details")};return E?s.jsxs("div",{className:"phases-section",children:[s.jsx("div",{className:"phases-header",children:s.jsx("h2",{children:"My Tasks"})}),s.jsx("div",{className:"loading",children:"Loading tasks..."})]}):s.jsxs("div",{className:"phases-section",children:[s.jsx("div",{className:"phases-header",children:s.jsx("h2",{children:"My Tasks"})}),s.jsx("div",{className:"phases-grid",children:v.map(e=>{const n=x(e.deadline)===null,d=e.isLate||n,i=e.isPendingTask&&d;return s.jsxs("div",{className:`phase-card ${i?"deadline-passed":""}`,children:[s.jsxs("div",{className:"phase-header",children:[s.jsx("h3",{className:"phase-title",children:e.title}),s.jsxs("span",{className:"phase-status",style:{color:I(e.status),backgroundColor:I(e.status)+"20"},children:[$(e.status)," ",e.status]})]}),s.jsx("p",{className:"phase-description",children:z(e.description,80)}),s.jsxs("div",{className:"phase-footer",children:[s.jsxs("span",{className:"phase-deadline",children:["Deadline: ",e.deadlineFormatted]}),s.jsx("button",{className:"phase-details-btn",onClick:()=>_(e),children:e.isPendingTask?"Submit":"Details"})]})]},e.id)})})]})};export{Z as default};
